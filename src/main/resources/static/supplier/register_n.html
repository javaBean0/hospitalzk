<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>添加证照信息</title>
    <link rel="stylesheet" type="text/css" href="../static/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="../static/css/admin.css"/>
    <link rel="stylesheet" href="../static/css/all.min.css"/>
    <script src="../static/js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="../static/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="../static/layui/layui.js" type="text/javascript" charset="utf-8"></script>
    <style>
        .layui-elem-field{
            width: 100%;
        }
        .btn{
            margin-top: 40px;
            margin-bottom: 30px;
            text-align: center;
        }
        .isbor{
            border: 1px solid #CCCCCC;
        }
        .layui-form{
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        .layui-form-item{
            margin-left: 30px;
        }
        th,td{
            text-align: center;
        }
    </style>
</head>
<body>
<div class="layui-row">
    <p style="height: 34px;width: 100%;line-height: 34px;background-color: lightyellow; text-align: center;">红色标识<span class="sign">* </span>为必填项,请认真填写</p>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend style="text-align: center;font-size: 22px;">添加证照信息</legend>
    </fieldset>
    <div class="col-xs-12">
        <form class="layui-form layui-form-pane" action="">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend style="color: red;">营业执照</legend>
            </fieldset>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>[正本]注册号</label>
                <div class="layui-input-block">
                    <input type="text" name="zzYyzch" placeholder="[正本]注册号" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">证照编号</label>
                <div class="layui-input-block">
                    <input type="text" name="zzYyzzbh" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">成立日期</label>
                <div class="layui-input-block">
                    <input id="date1" type="text" name="zzYyclrq" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">法定代表人</label>
                <div class="layui-input-block">
                    <input type="text" name="zzYyfdr" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">注册资金</label>
                <div class="layui-input-block">
                    <input type="zzYyzczj" name="zzYyzczj" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">企业类型</label>
                <div class="layui-input-block">
                    <select id="zzQylx" name="zzQylx" lay-verify="" lay-search>
                        <option value=""></option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>生效日期</label>
                <div class="layui-input-block">
                    <input id="date2" type="text" name="zzYysxrq" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>截止日期</label>
                <div class="layui-input-block">
                    <input id="date3" type="text" name="zzYyjzrq" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">长期有效</label>
                <div class="layui-input-block isbor">
                    <input type="radio" name="zzYyyx" value="是" title="是" checked>
                    <input type="radio" name="zzYyyx" value="否" title="否">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">质量管理人</label>
                <div class="layui-input-block">
                    <input type="text" name="zzZlglr" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">住所</label>
                <div class="layui-input-block">
                    <input type="text" name="zzZlglrdz" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">生产地址</label>
                <div class="layui-input-block">
                    <input type="text" name="zzYyscdz" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">仓库地址</label>
                <div class="layui-input-block">
                    <input type="text" name="zzCkdz" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">经营范围</label>
                <div class="layui-input-block">
                    <input type="text" name="zzYyjyfw" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-6">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <input type="text" name="zzYybz" class="layui-input" autocomplete="off">
                </div>
            </div>
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend style="color: red;">经营许可证</legend>
            </fieldset>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>证号</label>
                <div class="layui-input-block">
                    <input type="text" name="zzJyzh" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">企业负责人</label>
                <div class="layui-input-block">
                    <input type="text" name="zzJyqyfzr" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">法定代表人</label>
                <div class="layui-input-block">
                    <input type="text" name="zzJyfddbr" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>生效日期</label>
                <div class="layui-input-block">
                    <input id="date4" type="text" name="zzJysxrq" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>截止日期</label>
                <div class="layui-input-block">
                    <input id="date5" type="text" name="zzJyjzrq" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">长期有效</label>
                <div class="layui-input-block isbor">
                    <input type="radio" name="zzJyyx" value="是" title="是" checked>
                    <input type="radio" name="zzJyyx" value="否" title="否">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">注册地址</label>
                <div class="layui-input-block">
                    <input type="text" name="zzJyzcdz" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <input type="text" name="zzJybz" class="layui-input" autocomplete="off">
                </div>
            </div>
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend style="color: red;">组织机构代码证</legend>
            </fieldset>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>代码</label>
                <div class="layui-input-block">
                    <input type="text" name="zzZzdm" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>机构类型</label>
                <div class="layui-input-block">
                    <select id="zzZzlx" name="zzZzlx" lay-verify="" lay-search>
                        <option value=""></option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>生效日期</label>
                <div class="layui-input-block">
                    <input id="date6" type="text" name="zzZzsxrq" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label"><span style="color: red;">*</span>截止日期</label>
                <div class="layui-input-block">
                    <input id="date7" type="text" name="zzZzjzrq" class="layui-input" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">长期有效</label>
                <div class="layui-input-block isbor">
                    <input type="radio" name="zzZzyx" value="是" title="是" checked>
                    <input type="radio" name="zzZzyx" value="否" title="否">
                </div>
            </div>
            <div class="layui-form-item col-md-4">
                <label class="layui-form-label">机构地址</label>
                <div class="layui-input-block">
                    <input type="text" name="zzZzdz" class="layui-input" autocomplete="off">
                </div>
            </div>
            <div class="layui-form-item col-md-6">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <input type="text" name="zzZzbz" class="layui-input" autocomplete="off">
                </div>
            </div>
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend style="color: red;">文件上传 —— 文件大小小于 5 M</legend>
            </fieldset>
            <table class="layui-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">文件类型</th>
                        <th style="width: 50%;">上传</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>营业执照影印件</td>
                        <td>
                            <div class="layui-upload">
                                <button type="button"  class="layui-btn" id="yyzz">上传文件</button>
                                <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                                    预览图：
                                    <div class="layui-upload-list" id="yyzzImg"></div>
                                </blockquote>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>医疗器械经营许可证影印件</td>
                        <td>
                            <div class="layui-upload">
                                <button type="button" class="layui-btn" id="jyxk">上传文件</button>
                                <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                                    预览图：
                                    <div class="layui-upload-list" id="jyxkImg"></div>
                                </blockquote>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="layui-form-item col-md-12 btn">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-normal layui-btn-lg" lay-submit lay-filter="upFile">提交</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    $(function(){
        // 企业类型字典
        function qylxList(){
            // 清空当前列表
            $("#zzQylx").empty();
            // 添加默认选项
            var op = '<option value=""></option>';
            $("#zzQylx").append(op);
            // 发出ajax请求，并处理结果
            $.ajax({
                url:"/qylx/all",
                method: "GET",
                dataType: "JSON",
                async:false,
                "success":function(json){
                    // 遍历加载新列表项
                    var list = json.data;
                    for (var i = 0; i < list.length; i++) {
                        // console.log(list[i].eqlyId + " - " + list[i].eqlyName);
                        op = '<option value="' + list[i].qyLxcm + '">' + list[i].qyLxcm + '</option>';
                        $("#zzQylx").append(op);
                    }
                }
            });
        }
        qylxList();
        // 机构类型字典
        function jglxList(){
            // 清空当前列表
            $("#zzZzlx").empty();
            // 添加默认选项
            var op = '<option value=""></option>';
            $("#zzZzlx").append(op);
            // 发出ajax请求，并处理结果
            $.ajax({
                url:"/jglx/all",
                method: "GET",
                dataType: "JSON",
                async:false,
                "success":function(json){
                    // 遍历加载新列表项
                    var list = json.data;
                    for (var i = 0; i < list.length; i++) {
                        // console.log(list[i].eqlyId + " - " + list[i].eqlyName);
                        op = '<option value="' + list[i].jgLxmc + '">' + list[i].jgLxmc + '</option>';
                        $("#zzZzlx").append(op);
                    }
                }
            });
        }
        jglxList();
    });
    // 获取上个页面传递的类型
    var type = window.location.search;
    var ids = parseInt(type.split("=")[1]);
    layui.use(['jquery','layer','form','upload','laydate','element'],function(){
        var $ = layui.jquery
            ,layer = layui.layer
            ,form = layui.form
            ,upload = layui.upload
            ,laydate = layui.laydate
            ,element = layui.element;
        laydate.render({
            elem:"#date1"
        });
        laydate.render({
            elem:"#date2"
        });
        laydate.render({
            elem:"#date3"
        });
        laydate.render({
            elem:"#date4"
        });
        laydate.render({
            elem:"#date5"
        });
        laydate.render({
            elem:"#date6"
        });
        laydate.render({
            elem:"#date7"
        });
        // 营业执照影印件
        upload.render({
            elem: '#yyzz'
            ,url: '/wjsc/insertSuWj?sourceId='+ids+'&type='+1
            ,multiple: true
            ,accept:"file"
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#yyzzImg').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
                });
            }
            ,done:function(res){
                if(res.state === 200){
                    layer.msg("上传成功");
                }else{
                    layer.msg(res.message);
                }
            },
            error:function(data){
                layer.msg("上传失败,请稍后再试");
                console.log(data);
            }
        });
        // 医疗器械经营许可证影印件
        upload.render({
            elem: '#jyxk'
            ,url: '/wjsc/insertSuWj?sourceId='+ids+'&type='+2
            ,multiple: true
            ,accept:"file"
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#jyxkImg').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
                });
            }
            ,done:function(res){
                if(res.state === 200){
                    layer.msg("上传成功");
                }else{
                    layer.msg(res.message);
                }
            },
            error:function(data){
                layer.msg("上传失败,请稍后再试");
                console.log(data);
            }
        });
        // 提交
        form.on('submit(upFile)', function(data){
            console.log(data.field);
            $.ajax({
                url:"/zzinfo/insert?suId="+ids,
                method:"POST",
                data:data.field,
                dataType:"JSON",
                success:function(res){
                    if(res.state === 200){
                        layer.msg("提交成功");
                        setTimeout(function(){
                            layer.open({
                                    type: 1
                                    ,title: "提示" //不显示标题栏
                                    ,closeBtn: false
                                    ,area: '300px;'
                                    ,shade: 0.8
                                    ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
                                    ,btn: ['确定']
                                    ,btnAlign: 'c'
                                    ,moveType: 1 //拖拽模式，0或者1
                                    ,content: '<div style="padding: 30px; line-height: 22px; background-color: snow; color: #000000; text-align:center; font-weight: 300;">您的注册申请已经提交成功，请耐心等待审核，审核结果将以短信 / 邮箱方式通知您</div>'
                                    ,success: function(layero){
                                        var btn = layero.find('.layui-layer-btn');
                                        btn.find('.layui-layer-btn0').attr({
                                            href: "/userlogin.html"
                                        });
                                    }
                                });
                        	//location.href="/userlogin.html";
                        },1000);
                    }else if(res.state === 603){
                        layer.msg("213456789");
                    }else{
                        layer.msg("提交失败");
                    }
                },
                error:function(data){
                    layer.msg("请稍后再试");
                    console.log(data);
                }
            });
            return false;
        });
    })
</script>
</body>
</html>